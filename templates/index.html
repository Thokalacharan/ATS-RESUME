<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATS Resume Checker - Professional Resume Analysis</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                    <rect width="40" height="40" rx="8" fill="#6366f1"/>
                    <path d="M12 20L18 26L28 14" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <h1>ATS Resume Checker</h1>
            </div>
            <nav class="nav">
                <a href="#features">Features</a>
                <a href="#how-it-works">How It Works</a>
                <a href="#upload">Check Resume</a>
            </nav>
        </div>
    </header>

    <!-- Demo Mode Banner -->
    {% if demo_mode %}
    <div class="demo-banner">
        <div class="container">
            <div class="demo-content">
                <span class="demo-icon">üéØ</span>
                <div class="demo-text">
                    <strong>Demo Mode Active</strong>
                    <span>Using intelligent mock analysis. Results are consistent and realistic for demonstration purposes.</span>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h2 class="hero-title">Get Your Resume ATS Score in Seconds</h2>
                <p class="hero-subtitle">Upload your resume and get instant feedback on how well it performs in Applicant Tracking Systems</p>
                <a href="#upload" class="cta-button">Analyze My Resume</a>
            </div>
            <div class="hero-image">
                <div class="stats-card">
                    <div class="stat">
                        <div class="stat-number">95%</div>
                        <div class="stat-label">Average Score Improvement</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">10k+</div>
                        <div class="stat-label">Resumes Analyzed</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="features">
        <div class="container">
            <h2 class="section-title">Why Use Our ATS Checker?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3>Accurate ATS Scoring</h3>
                    <p>Get a precise score out of 100 to understand how well your resume will perform</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚úÖ</div>
                    <h3>Detailed Pros Analysis</h3>
                    <p>Discover what's working well in your resume and your key strengths</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîç</div>
                    <h3>Improvement Suggestions</h3>
                    <p>Get actionable feedback on areas that need improvement</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Instant Results</h3>
                    <p>Receive your analysis in seconds powered by advanced AI</p>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section id="how-it-works" class="how-it-works">
        <div class="container">
            <h2 class="section-title">How It Works</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Upload Resume</h3>
                    <p>Upload your resume in PDF format</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>AI Analysis</h3>
                    <p>Our AI analyzes your resume against ATS standards</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Get Results</h3>
                    <p>Receive your score, pros, and improvement areas</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Upload Section -->
    <section id="upload" class="upload-section">
        <div class="container">
            <div class="upload-container">
                <h2 class="section-title">Analyze Your Resume</h2>
                <p class="upload-subtitle">Choose your analysis mode and get instant ATS feedback</p>
                
                <!-- Mode Selection -->
                <div class="mode-selection">
                    <label class="mode-option">
                        <input type="radio" name="analysisMode" value="direct" checked>
                        <div class="mode-card">
                            <div class="mode-icon">üéØ</div>
                            <h3>Direct ATS Check</h3>
                            <p>Get general ATS score without job description</p>
                        </div>
                    </label>
                    <label class="mode-option">
                        <input type="radio" name="analysisMode" value="job_description">
                        <div class="mode-card">
                            <div class="mode-icon">üìã</div>
                            <h3>Job Description Match</h3>
                            <p>Compare resume against specific job requirements</p>
                        </div>
                    </label>
                </div>
                
                <form id="uploadForm" class="upload-form">
                    <!-- Job Description Field (hidden by default) -->
                    <div id="jobDescriptionField" class="job-description-field hidden">
                        <label for="jobDescription">Job Description</label>
                        <textarea 
                            id="jobDescription" 
                            name="job_description" 
                            placeholder="Paste the job description here..."
                            rows="8"
                        ></textarea>
                    </div>
                    
                    <div class="file-upload-wrapper">
                        <input type="file" id="resumeFile" name="resume" accept=".pdf" required hidden>
                        <label for="resumeFile" class="file-upload-label">
                            <div class="upload-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                            </div>
                            <span class="upload-text">Click to upload or drag and drop</span>
                            <span class="upload-subtext">PDF files only (Max 16MB)</span>
                        </label>
                        <div id="fileName" class="file-name"></div>
                    </div>
                    <button type="submit" class="submit-button" id="analyzeButton">
                        <span>Analyze Resume</span>
                    </button>
                </form>

                <div id="loading" class="loading hidden">
                    <div class="loader"></div>
                    <p>Analyzing your resume...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Results Section -->
    <section id="results" class="results-section hidden">
        <div class="container">
            <div class="results-container">
                <h2 class="section-title">Your ATS Analysis Results</h2>
                
                <!-- Score Card -->
                <div class="score-card">
                    <div class="score-circle">
                        <svg class="score-svg" viewBox="0 0 200 200">
                            <circle class="score-bg" cx="100" cy="100" r="85"></circle>
                            <circle class="score-fill" cx="100" cy="100" r="85" id="scoreCircle"></circle>
                        </svg>
                        <div class="score-text">
                            <div class="score-number" id="scoreNumber">0</div>
                            <div class="score-label">ATS Score</div>
                        </div>
                    </div>
                    <div class="score-interpretation" id="scoreInterpretation"></div>
                </div>

                <!-- Pros and Cons -->
                <div class="analysis-grid">
                    <div class="analysis-card pros-card">
                        <div class="analysis-header">
                            <div class="analysis-icon">‚úÖ</div>
                            <h3>Strengths</h3>
                        </div>
                        <ul id="prosList" class="analysis-list"></ul>
                    </div>

                    <div class="analysis-card cons-card">
                        <div class="analysis-header">
                            <div class="analysis-icon">üîç</div>
                            <h3>Areas for Improvement</h3>
                        </div>
                        <ul id="consList" class="analysis-list"></ul>
                    </div>
                </div>

                <div class="actions">
                    <button class="primary-button" id="downloadButton" onclick="downloadReport()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Download Report
                    </button>
                    <button class="secondary-button" onclick="location.reload()">Analyze Another Resume</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 ATS Resume Checker. Powered by AI.</p>
        </div>
    </footer>

    <script>
        const uploadForm = document.getElementById('uploadForm');
        const resumeFile = document.getElementById('resumeFile');
        const fileName = document.getElementById('fileName');
        const loading = document.getElementById('loading');
        const resultsSection = document.getElementById('results');
        const uploadSection = document.getElementById('upload');
        const jobDescriptionField = document.getElementById('jobDescriptionField');
        const modeRadios = document.querySelectorAll('input[name="analysisMode"]');
        
        // Store the latest analysis data for download
        let latestAnalysisData = null;

        // Mode selection handler
        modeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'job_description') {
                    jobDescriptionField.classList.remove('hidden');
                    document.getElementById('jobDescription').required = true;
                } else {
                    jobDescriptionField.classList.add('hidden');
                    document.getElementById('jobDescription').required = false;
                    document.getElementById('jobDescription').value = '';
                }
            });
        });

        // File input change handler
        resumeFile.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                fileName.textContent = `Selected: ${e.target.files[0].name}`;
                fileName.style.display = 'block';
            }
        });

        // Drag and drop
        const fileUploadLabel = document.querySelector('.file-upload-label');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileUploadLabel.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            fileUploadLabel.addEventListener(eventName, () => {
                fileUploadLabel.classList.add('drag-over');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            fileUploadLabel.addEventListener(eventName, () => {
                fileUploadLabel.classList.remove('drag-over');
            }, false);
        });

        fileUploadLabel.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            resumeFile.files = files;
            if (files.length > 0) {
                fileName.textContent = `Selected: ${files[0].name}`;
                fileName.style.display = 'block';
            }
        }

        // Form submission
        uploadForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const file = resumeFile.files[0];
            if (!file) {
                alert('Please select a PDF file');
                return;
            }
            
            const selectedMode = document.querySelector('input[name="analysisMode"]:checked').value;
            const jobDescription = document.getElementById('jobDescription').value.trim();
            
            if (selectedMode === 'job_description' && !jobDescription) {
                alert('Please enter a job description for job match analysis');
                return;
            }

            const formData = new FormData();
            formData.append('resume', file);
            if (selectedMode === 'job_description') {
                formData.append('job_description', jobDescription);
            }

            // Show loading
            loading.classList.remove('hidden');
            document.getElementById('analyzeButton').disabled = true;

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.error) {
                    alert('Error: ' + data.error);
                    return;
                }
                
                // Store data for download
                latestAnalysisData = {
                    ...data,
                    filename: file.name,
                    analysisDate: new Date().toLocaleString()
                };

                // Hide loading and show results
                loading.classList.add('hidden');
                displayResults(data);
                
                // Smooth scroll to results
                resultsSection.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                alert('Error analyzing resume: ' + error.message);
            } finally {
                loading.classList.add('hidden');
                document.getElementById('analyzeButton').disabled = false;
            }
        });

        function displayResults(data) {
            // Display score
            const score = data.score || 0;
            document.getElementById('scoreNumber').textContent = score;
            
            // Animate score circle
            const circumference = 2 * Math.PI * 85;
            const scoreCircle = document.getElementById('scoreCircle');
            const offset = circumference - (score / 100) * circumference;
            scoreCircle.style.strokeDashoffset = offset;

            // Score interpretation
            const interpretation = getScoreInterpretation(score);
            document.getElementById('scoreInterpretation').innerHTML = `
                <h4>${interpretation.title}</h4>
                <p>${interpretation.message}</p>
            `;

            // Display pros
            const prosList = document.getElementById('prosList');
            prosList.innerHTML = '';
            data.pros.forEach(pro => {
                const li = document.createElement('li');
                li.innerHTML = formatText(pro);
                prosList.appendChild(li);
            });

            // Display cons
            const consList = document.getElementById('consList');
            consList.innerHTML = '';
            data.cons.forEach(con => {
                const li = document.createElement('li');
                li.innerHTML = formatText(con);
                consList.appendChild(li);
            });

            // Show results section
            resultsSection.classList.remove('hidden');
        }

        function getScoreInterpretation(score) {
            if (score >= 80) {
                return {
                    title: 'Excellent! üéâ',
                    message: 'Your resume is well-optimized for ATS systems. Just minor tweaks needed.'
                };
            } else if (score >= 60) {
                return {
                    title: 'Good Progress! üëç',
                    message: 'Your resume has a solid foundation. Focus on the improvement areas to boost your score.'
                };
            } else if (score >= 40) {
                return {
                    title: 'Needs Improvement üìù',
                    message: 'Your resume needs significant work. Review the suggestions carefully.'
                };
            } else {
                return {
                    title: 'Major Revision Required ‚ö†Ô∏è',
                    message: 'Your resume may struggle with ATS systems. Consider a complete restructure.'
                };
            }
        }

        function formatText(text) {
            // Remove markdown formatting and convert to clean HTML
            let formatted = text;
            
            // Convert **bold** to <strong>
            formatted = formatted.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            
            // Convert *italic* to <em>
            formatted = formatted.replace(/\*(.+?)\*/g, '<em>$1</em>');
            
            // Convert "quoted text" to highlighted span
            formatted = formatted.replace(/"([^"]+)"/g, '<span class="highlight">$1</span>');
            
            // Clean up any remaining single asterisks
            formatted = formatted.replace(/\*/g, '');
            
            return formatted;
        }
        
        // Download report functionality
        function downloadReport() {
            if (!latestAnalysisData) {
                alert('No analysis data available');
                return;
            }
            
            const data = latestAnalysisData;
            const mode = data.mode === 'with_job_description' ? 'Job Description Match' : 'Direct ATS Check';
            
            // Create text content for the report
            let reportContent = `ATS RESUME ANALYSIS REPORT
========================================

Resume File: ${data.filename || 'Unknown'}
Analysis Date: ${data.analysisDate}
Analysis Mode: ${mode}
ATS Score: ${data.score}/100

${getScoreInterpretationText(data.score)}

========================================
STRENGTHS
========================================

`;
            
            data.pros.forEach((pro, index) => {
                reportContent += `${index + 1}. ${stripHtml(pro)}\n`;
            });
            
            reportContent += `
========================================
AREAS FOR IMPROVEMENT
========================================

`;
            
            data.cons.forEach((con, index) => {
                reportContent += `${index + 1}. ${stripHtml(con)}\n`;
            });
            
            reportContent += `
========================================
RECOMMENDATIONS
========================================

Based on your ${data.score}/100 score, we recommend:
`;
            
            if (data.score >= 80) {
                reportContent += `
- Focus on fine-tuning your resume for specific job applications
- Maintain the current strong formatting and keyword usage
- Continue to update your achievements with measurable results
`;
            } else if (data.score >= 60) {
                reportContent += `
- Address the areas for improvement listed above
- Add more industry-specific keywords
- Quantify your achievements with numbers and metrics
- Review and improve formatting for ATS compatibility
`;
            } else if (data.score >= 40) {
                reportContent += `
- Significantly revise your resume structure
- Research industry keywords and incorporate them
- Focus on clear, ATS-friendly formatting
- Highlight achievements with concrete examples
`;
            } else {
                reportContent += `
- Consider a complete resume restructure
- Use an ATS-friendly template
- Research your target industry's keywords thoroughly
- Seek professional resume writing assistance if needed
`;
            }
            
            reportContent += `
========================================
Generated by ATS Resume Checker
========================================
`;
            
            // Create and download the file
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ATS_Report_${data.score}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        function stripHtml(html) {
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }
        
        function getScoreInterpretationText(score) {
            if (score >= 80) {
                return 'Rating: Excellent! Your resume is well-optimized for ATS systems.';
            } else if (score >= 60) {
                return 'Rating: Good Progress! Your resume has a solid foundation.';
            } else if (score >= 40) {
                return 'Rating: Needs Improvement. Your resume needs significant work.';
            } else {
                return 'Rating: Major Revision Required. Your resume may struggle with ATS systems.';
            }
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    </script>
</body>
</html>
